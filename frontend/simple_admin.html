<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Garajburada.com</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            font-size: 14px;
        }

        .header {
            background: #1e293b;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            font-size: 24px;
        }

        .brand {
            font-size: 18px;
            font-weight: bold;
        }

        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            color: white;
        }

        .btn-primary { background: #3b82f6; }
        .btn-success { background: #10b981; }
        .btn-danger { background: #ef4444; }
        .btn-info { background: #06b6d4; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-size: 14px;
        }

        .tab.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card h3 {
            margin-bottom: 1rem;
            color: #1f2937;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th, td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: #f9fafb;
            font-weight: bold;
        }

        .status {
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }

        .status-pending { background: #fee2e2; color: #991b1b; }
        .status-active { background: #d1fae5; color: #065f46; }
        .status-inactive { background: #fee2e2; color: #991b1b; }
        .status-rejected { background: #fecaca; color: #dc2626; }

        .role {
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }

        .role-user { background: #e0e7ff; color: #3730a3; }
        .role-moderator { background: #fef3c7; color: #92400e; }
        .role-admin { background: #dcfce7; color: #166534; }
        .role-superadmin { background: #fce7f3; color: #be185d; }

        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 11px;
            margin: 0 0.25rem;
        }

        .alert {
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            font-size: 12px;
        }

        .alert-success { background: #d1fae5; color: #065f46; }
        .alert-error { background: #fee2e2; color: #991b1b; }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <span class="logo-icon">ğŸš—</span>
            <span class="brand">Garajburada.com - Admin Panel</span>
        </div>
        <div class="nav-buttons">
            <button class="btn btn-primary" onclick="refreshData()">Yenile</button>
            <button class="btn btn-danger" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</button>
        </div>
    </div>

    <div class="container">
        <div id="alert" class="alert" style="display: none;"></div>

        <!-- Dashboard Ä°statistikleri -->
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
            <div class="stat-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 2rem; color: #3b82f6; margin-bottom: 0.5rem;">ğŸ‘¥</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;" id="totalUsers">-</div>
                <div style="font-size: 0.8rem; color: #6b7280;">Toplam KullanÄ±cÄ±</div>
            </div>
            <div class="stat-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 2rem; color: #ef4444; margin-bottom: 0.5rem;">â³</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;" id="pendingUsers">-</div>
                <div style="font-size: 0.8rem; color: #6b7280;">Bekleyen KullanÄ±cÄ±</div>
            </div>
            <div class="stat-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 2rem; color: #10b981; margin-bottom: 0.5rem;">ğŸ“‹</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;" id="totalListings">-</div>
                <div style="font-size: 0.8rem; color: #6b7280;">Toplam Ä°lan</div>
            </div>
            <div class="stat-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 2rem; color: #f59e0b; margin-bottom: 0.5rem;">ğŸ’°</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;" id="totalPayments">-</div>
                <div style="font-size: 0.8rem; color: #6b7280;">Toplam Ã–deme</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('users')">KullanÄ±cÄ±lar</div>
            <div class="tab" onclick="showTab('listings')">Ä°lanlar</div>
            <div class="tab" onclick="showTab('expired')">SÃ¼resi Biten Ä°lanlar</div>
            <div class="tab" onclick="showTab('payments')">Ã–demeler</div>
            <div class="tab" onclick="showTab('analytics')">Grafikler</div>
            <div class="tab" onclick="showTab('bulk')">Toplu Ä°ÅŸlemler</div>
        </div>

        <!-- KullanÄ±cÄ±lar Tab -->
        <div id="users" class="tab-content active">
            <div class="card">
                <h3>KullanÄ±cÄ± YÃ¶netimi</h3>
                
                <!-- Arama ve Filtreleme -->
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                    <input type="text" id="userSearch" placeholder="KullanÄ±cÄ± ara..." style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px; flex: 1;">
                    <select id="roleFilter" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="">TÃ¼m Roller</option>
                        <option value="user">KullanÄ±cÄ±</option>
                        <option value="moderator">ModeratÃ¶r</option>
                        <option value="admin">Admin</option>
                        <option value="superadmin">SÃ¼per Admin</option>
                    </select>
                    <select id="statusFilter" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="">TÃ¼m Durumlar</option>
                        <option value="active">Aktif</option>
                        <option value="pending">Bekleyen</option>
                        <option value="inactive">Pasif</option>
                    </select>
                    <button class="btn btn-primary" onclick="filterUsers()">Filtrele</button>
                    <button class="btn btn-primary" onclick="clearUserFilters()">Temizle</button>
                </div>
                
                <div id="usersLoading" class="loading">KullanÄ±cÄ±lar yÃ¼kleniyor...</div>
                <table id="usersTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Ad</th>
                            <th>Rol</th>
                            <th>Durum</th>
                            <th>KayÄ±t Tarihi</th>
                            <th>Ä°ÅŸlemler</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Ä°lanlar Tab -->
        <div id="listings" class="tab-content">
            <div class="card">
                <h3>Ä°lan YÃ¶netimi</h3>
                <div id="listingsLoading" class="loading">Ä°lanlar yÃ¼kleniyor...</div>
                <table id="listingsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>BaÅŸlÄ±k</th>
                            <th>KullanÄ±cÄ±</th>
                            <th>Fiyat</th>
                            <th>Durum</th>
                            <th>Ä°ÅŸlemler</th>
                        </tr>
                    </thead>
                    <tbody id="listingsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- SÃ¼resi Biten Ä°lanlar Tab -->
        <div id="expired" class="tab-content">
            <div class="card">
                <h3>SÃ¼resi Biten Ä°lanlar</h3>
                
                <!-- Filtreleme SeÃ§enekleri -->
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                    <select id="expiredFilter" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="all">TÃ¼m SÃ¼resi Biten Ä°lanlar</option>
                        <option value="today">BugÃ¼n SÃ¼resi Bitenler</option>
                        <option value="week">Bu Hafta SÃ¼resi Bitenler</option>
                        <option value="month">Bu Ay SÃ¼resi Bitenler</option>
                    </select>
                    <button class="btn btn-primary" onclick="filterExpiredListings()">Filtrele</button>
                    <button class="btn btn-success" onclick="extendAllExpired()">TÃ¼mÃ¼nÃ¼ Uzat</button>
                    <button class="btn btn-danger" onclick="deleteAllExpired()">TÃ¼mÃ¼nÃ¼ Sil</button>
                </div>
                
                <div id="expiredLoading" class="loading">SÃ¼resi biten ilanlar yÃ¼kleniyor...</div>
                <table id="expiredTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>BaÅŸlÄ±k</th>
                            <th>KullanÄ±cÄ±</th>
                            <th>Fiyat</th>
                            <th>BitiÅŸ Tarihi</th>
                            <th>Kalan SÃ¼re</th>
                            <th>Durum</th>
                            <th>Ä°ÅŸlemler</th>
                        </tr>
                    </thead>
                    <tbody id="expiredTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Ã–demeler Tab -->
        <div id="payments" class="tab-content">
            <div class="card">
                <h3>Ã–deme YÃ¶netimi</h3>
                <div id="paymentsLoading" class="loading">Ã–demeler yÃ¼kleniyor...</div>
                <table id="paymentsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>KullanÄ±cÄ±</th>
                            <th>Tutar</th>
                            <th>AÃ§Ä±klama</th>
                            <th>Durum</th>
                            <th>Tarih</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Grafikler Tab -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <h3>Analitik ve Raporlar</h3>
                
                <!-- Grafik Kontrolleri -->
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                    <select id="chartPeriod" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="7">Son 7 GÃ¼n</option>
                        <option value="30" selected>Son 30 GÃ¼n</option>
                        <option value="90">Son 3 Ay</option>
                        <option value="365">Son 1 YÄ±l</option>
                    </select>
                    <button class="btn btn-primary" onclick="updateCharts()">Grafikleri GÃ¼ncelle</button>
                    <button class="btn btn-success" onclick="exportReport()">Rapor Ä°ndir</button>
                </div>

                <!-- Grafik Grid -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <!-- KullanÄ±cÄ± ArtÄ±ÅŸ GrafiÄŸi -->
                    <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="margin-bottom: 1rem; color: #1f2937;">KullanÄ±cÄ± ArtÄ±ÅŸÄ±</h4>
                        <canvas id="userGrowthChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- Ä°lan Ä°statistikleri -->
                    <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="margin-bottom: 1rem; color: #1f2937;">Ä°lan DurumlarÄ±</h4>
                        <canvas id="listingStatusChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Ã–deme GrafiÄŸi -->
                <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom: 1rem; color: #1f2937;">AylÄ±k Ã–deme Gelirleri</h4>
                    <canvas id="paymentRevenueChart" width="800" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Toplu Ä°ÅŸlemler Tab -->
        <div id="bulk" class="tab-content">
            <div class="card">
                <h3>Toplu Ä°ÅŸlemler</h3>
                
                <!-- Ä°ÅŸlem SeÃ§imi -->
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                    <select id="bulkActionType" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="">Ä°ÅŸlem TÃ¼rÃ¼ SeÃ§in</option>
                        <option value="users">KullanÄ±cÄ± Ä°ÅŸlemleri</option>
                        <option value="listings">Ä°lan Ä°ÅŸlemleri</option>
                        <option value="payments">Ã–deme Ä°ÅŸlemleri</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadBulkData()">Verileri YÃ¼kle</button>
                    <button class="btn btn-success" onclick="selectAllItems()">TÃ¼mÃ¼nÃ¼ SeÃ§</button>
                    <button class="btn btn-primary" onclick="deselectAllItems()">SeÃ§imi KaldÄ±r</button>
                </div>

                <!-- Toplu Ä°ÅŸlem ButonlarÄ± -->
                <div id="bulkActionButtons" style="margin-bottom: 1rem; display: none;">
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="bulkActivate()">Toplu AktifleÅŸtir</button>
                        <button class="btn btn-success" onclick="singleActivate()">Tek AktifleÅŸtir</button>
                        <button class="btn btn-danger" onclick="bulkDeactivate()">Toplu PasifleÅŸtir</button>
                        <button class="btn btn-primary" onclick="bulkDelete()">Toplu Sil</button>
                        <button class="btn btn-success" onclick="bulkExport()">Toplu DÄ±ÅŸa Aktar</button>
                        <button class="btn btn-primary" onclick="bulkSendMessage()">Toplu Mesaj GÃ¶nder</button>
                    </div>
                </div>

                <!-- SeÃ§im Bilgisi -->
                <div id="selectionInfo" style="margin-bottom: 1rem; padding: 0.5rem; background: #f3f4f6; border-radius: 5px; display: none;">
                    <span id="selectedCount">0</span> Ã¶ÄŸe seÃ§ildi
                </div>

                <!-- Toplu Ä°ÅŸlem Tablosu -->
                <div id="bulkTableContainer" style="display: none;">
                    <table id="bulkTable" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead>
                            <tr>
                                <th style="width: 30px;">
                                    <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                                </th>
                                <th>ID</th>
                                <th>Ad/Email</th>
                                <th>Durum</th>
                                <th>Tarih</th>
                                <th>Ä°ÅŸlemler</th>
                            </tr>
                        </thead>
                        <tbody id="bulkTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Demo veriler
        const demoUsers = [
            { id: 1, email: 'admin@garajburada.com', name: 'Admin User', role: 'superadmin', status: 'active', createdAt: '2025-07-28' },
            { id: 2, email: 'moderator@garajburada.com', name: 'Moderator User', role: 'moderator', status: 'active', createdAt: '2025-07-28' },
            { id: 3, email: 'user@garajburada.com', name: 'Normal User', role: 'user', status: 'active', createdAt: '2025-07-28' },
            { id: 4, email: 'bekirelbeyoglu27@gmail.com', name: 'bekirelbeyoÄŸlu', role: 'user', status: 'pending', createdAt: '2025-07-28' },
            { id: 5, email: 'jane.smith@example.com', name: 'Jane Smith', role: 'user', status: 'pending', createdAt: '2025-04-05' }
        ];

        const demoListings = [
            { id: 1, title: '2020 BMW 3 Serisi', user: 'user@garajburada.com', price: '850.000 â‚º', status: 'active' },
            { id: 2, title: '2019 Mercedes C Serisi', user: 'user@garajburada.com', price: '920.000 â‚º', status: 'pending' },
            { id: 3, title: '2021 Audi A4', user: 'user@garajburada.com', price: '780.000 â‚º', status: 'active' }
        ];

        const demoPayments = [
            { id: 1, user: 'user@garajburada.com', amount: '800 â‚º', description: 'Premium Ä°lan', status: 'completed', date: '2025-07-28' },
            { id: 2, user: 'user@garajburada.com', amount: '1200 â‚º', description: 'Premium Plus Ä°lan', status: 'pending', date: '2025-07-28' }
        ];

        // Tab deÄŸiÅŸtirme
        function showTab(tabName) {
            // TÃ¼m tablarÄ± gizle
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // SeÃ§ili tabÄ± gÃ¶ster
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Tab iÃ§eriÄŸini yÃ¼kle
            if (tabName === 'users') {
                loadUsers();
            } else if (tabName === 'listings') {
                loadListings();
            } else if (tabName === 'expired') {
                loadExpiredListings();
            } else if (tabName === 'payments') {
                loadPayments();
            }
        }

        // KullanÄ±cÄ±larÄ± yÃ¼kle
        async function loadUsers() {
            const loading = document.getElementById('usersLoading');
            const table = document.getElementById('usersTable');

            loading.style.display = 'block';
            table.style.display = 'none';

            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('http://localhost:8000/api/admin/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                } else {
                    // API Ã§alÄ±ÅŸmÄ±yorsa demo verileri kullan
                    displayUsers(demoUsers);
                }
            } catch (error) {
                console.log("API hatasÄ±, demo veriler kullanÄ±lÄ±yor:", error);
                displayUsers(demoUsers);
            }

            loading.style.display = 'none';
            table.style.display = 'table';
        }

        // KullanÄ±cÄ±larÄ± gÃ¶ster
        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.email}</td>
                    <td>${user.name || '-'}</td>
                    <td><span class="role role-${user.role}">${user.role}</span></td>
                    <td><span class="status status-${user.status}">${user.status === 'active' ? 'Aktif' : user.status === 'pending' ? 'Bekleyen' : 'Pasif'}</span></td>
                    <td>${user.createdAt}</td>
                    <td>
                        <button class="btn btn-small btn-success" onclick="toggleUserStatus(${user.id})" ${user.status === 'active' ? 'disabled' : ''}>
                            ${user.status === 'active' ? 'Aktif' : 'AktifleÅŸtir'}
                        </button>
                        <button class="btn btn-small btn-primary" onclick="changeUserRole(${user.id})">
                            Rol DeÄŸiÅŸtir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // KullanÄ±cÄ± durumu deÄŸiÅŸtir
        async function toggleUserStatus(userId) {
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch(`http://localhost:8000/api/admin/users/${userId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'active' })
                });

                if (response.ok) {
                    showAlert('KullanÄ±cÄ± baÅŸarÄ±yla aktifleÅŸtirildi!', 'success');
                    loadUsers();
                } else {
                    // Demo modda gÃ¼ncelle
                    const user = demoUsers.find(u => u.id === userId);
                    if (user) {
                        user.status = 'active';
                        showAlert(`KullanÄ±cÄ± ${user.name || user.email} aktifleÅŸtirildi!`, 'success');
                        displayUsers(demoUsers);
                    }
                }
            } catch (error) {
                // Demo modda gÃ¼ncelle
                const user = demoUsers.find(u => u.id === userId);
                if (user) {
                    user.status = 'active';
                    showAlert(`KullanÄ±cÄ± ${user.name || user.email} aktifleÅŸtirildi!`, 'success');
                    displayUsers(demoUsers);
                }
            }
        }

        // KullanÄ±cÄ± rolÃ¼ deÄŸiÅŸtir
        function changeUserRole(userId) {
            const user = demoUsers.find(u => u.id === userId);
            if (!user) return;

            const roles = ['user', 'moderator', 'admin', 'superadmin'];
            const currentIndex = roles.indexOf(user.role);
            const nextIndex = (currentIndex + 1) % roles.length;
            const newRole = roles[nextIndex];

            user.role = newRole;
            showAlert(`KullanÄ±cÄ± ${user.name || user.email} rolÃ¼ ${newRole} olarak deÄŸiÅŸtirildi!`, 'success');
            displayUsers(demoUsers);
        }

        // Ä°lanlarÄ± yÃ¼kle
        function loadListings() {
            const loading = document.getElementById('listingsLoading');
            const table = document.getElementById('listingsTable');

            loading.style.display = 'block';
            table.style.display = 'none';

            setTimeout(() => {
                displayListings(demoListings);
                loading.style.display = 'none';
                table.style.display = 'table';
            }, 500);
        }

        // Ä°lanlarÄ± gÃ¶ster
        function displayListings(listings) {
            const tbody = document.getElementById('listingsTableBody');
            tbody.innerHTML = '';

            listings.forEach(listing => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${listing.id}</td>
                    <td>${listing.title}</td>
                    <td>${listing.user}</td>
                    <td>${listing.price}</td>
                    <td><span class="status status-${listing.status}">${listing.status === 'active' ? 'Aktif' : listing.status === 'rejected' ? 'Reddedildi' : 'Bekliyor'}</span></td>
                    <td>
                        <button class="btn btn-small btn-info" onclick="viewListing(${listing.id})" style="margin-right: 5px;">
                            GÃ¶rÃ¼ntÃ¼le
                        </button>
                        <button class="btn btn-small btn-success" onclick="approveListing(${listing.id})" ${listing.status === 'active' ? 'disabled' : ''}>
                            ${listing.status === 'active' ? 'OnaylandÄ±' : 'Onayla'}
                        </button>
                        <button class="btn btn-small btn-danger" onclick="rejectListing(${listing.id})" ${listing.status === 'rejected' ? 'disabled' : ''}>
                            ${listing.status === 'rejected' ? 'Reddedildi' : 'Reddet'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Ä°lan gÃ¶rÃ¼ntÃ¼le
        function viewListing(listingId) {
            const listing = demoListings.find(l => l.id === listingId);
            if (listing) {
                const statusText = listing.status === 'active' ? 'Aktif' : 
                                  listing.status === 'rejected' ? 'Reddedildi' : 'Bekliyor';
                const details = `
                    <strong>Ä°lan DetaylarÄ±:</strong><br>
                    <strong>ID:</strong> ${listing.id}<br>
                    <strong>BaÅŸlÄ±k:</strong> ${listing.title}<br>
                    <strong>KullanÄ±cÄ±:</strong> ${listing.user}<br>
                    <strong>Fiyat:</strong> ${listing.price}<br>
                    <strong>Durum:</strong> ${statusText}<br>
                    <strong>OluÅŸturulma:</strong> ${listing.created_at || '2025-07-28'}
                `;
                
                // Modal veya alert ile gÃ¶ster
                if (confirm(details + '\n\nBu ilanÄ± detaylÄ± gÃ¶rÃ¼ntÃ¼lemek istiyor musunuz?')) {
                    // GerÃ§ek uygulamada yeni sayfa aÃ§Ä±labilir
                    window.open(`/listing/${listing.id}`, '_blank');
                }
            }
        }

        // Ä°lan onayla
        function approveListing(listingId) {
            const listing = demoListings.find(l => l.id === listingId);
            if (listing) {
                listing.status = 'active';
                showAlert(`Ä°lan ${listing.title} onaylandÄ±!`, 'success');
                displayListings(demoListings);
            }
        }

        // Ä°lan reddet
        function rejectListing(listingId) {
            const listing = demoListings.find(l => l.id === listingId);
            if (listing) {
                if (confirm(`Ä°lan "${listing.title}" reddedilecek. Bu iÅŸlem geri alÄ±namaz. Devam etmek istiyor musunuz?`)) {
                    listing.status = 'rejected';
                    showAlert(`Ä°lan ${listing.title} reddedildi!`, 'error');
                    displayListings(demoListings);
                }
            }
        }

        // Ã–demeleri yÃ¼kle
        function loadPayments() {
            const loading = document.getElementById('paymentsLoading');
            const table = document.getElementById('paymentsTable');

            loading.style.display = 'block';
            table.style.display = 'none';

            setTimeout(() => {
                displayPayments(demoPayments);
                loading.style.display = 'none';
                table.style.display = 'table';
            }, 500);
        }

        // Ã–demeleri gÃ¶ster
        function displayPayments(payments) {
            const tbody = document.getElementById('paymentsTableBody');
            tbody.innerHTML = '';

            payments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.id}</td>
                    <td>${payment.user}</td>
                    <td>${payment.amount}</td>
                    <td>${payment.description}</td>
                    <td><span class="status status-${payment.status}">${payment.status === 'completed' ? 'TamamlandÄ±' : 'Bekliyor'}</span></td>
                    <td>${payment.date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Alert gÃ¶ster
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';

            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        // KullanÄ±cÄ± filtreleme
        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            const filteredUsers = demoUsers.filter(user => {
                const matchesSearch = user.name?.toLowerCase().includes(searchTerm) || 
                                    user.email.toLowerCase().includes(searchTerm);
                const matchesRole = !roleFilter || user.role === roleFilter;
                const matchesStatus = !statusFilter || user.status === statusFilter;
                
                return matchesSearch && matchesRole && matchesStatus;
            });
            
            displayUsers(filteredUsers);
            showAlert(`${filteredUsers.length} kullanÄ±cÄ± bulundu`, 'success');
        }

        // Filtreleri temizle
        function clearUserFilters() {
            document.getElementById('userSearch').value = '';
            document.getElementById('roleFilter').value = '';
            document.getElementById('statusFilter').value = '';
            displayUsers(demoUsers);
            showAlert('Filtreler temizlendi', 'success');
        }

        // Verileri yenile
        function refreshData() {
            showAlert('Veriler yenileniyor...', 'success');
            loadUsers();
            updateStats();
        }

        // Ã‡Ä±kÄ±ÅŸ yap
        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userRole');
            window.location.href = 'login.html';
        }

        // Ä°statistikleri gÃ¼ncelle
        function updateStats() {
            // KullanÄ±cÄ± istatistikleri
            document.getElementById('totalUsers').textContent = demoUsers.length;
            document.getElementById('pendingUsers').textContent = demoUsers.filter(u => u.status === 'pending').length;
            
            // Ä°lan istatistikleri
            document.getElementById('totalListings').textContent = demoListings.length;
            
            // Ã–deme istatistikleri
            document.getElementById('totalPayments').textContent = demoPayments.length;
        }

        // Grafik deÄŸiÅŸkenleri
        let userGrowthChart, listingStatusChart, paymentRevenueChart;

        // Grafikleri gÃ¼ncelle
        function updateCharts() {
            const period = document.getElementById('chartPeriod').value;
            initUserGrowthChart(period);
            initListingStatusChart();
            initPaymentRevenueChart();
        }

        // KullanÄ±cÄ± artÄ±ÅŸ grafiÄŸi
        function initUserGrowthChart(period = 30) {
            const ctx = document.getElementById('userGrowthChart').getContext('2d');
            
            if (userGrowthChart) {
                userGrowthChart.destroy();
            }

            // Demo veri - gerÃ§ek uygulamada API'den gelecek
            const labels = [];
            const data = [];
            const today = new Date();
            
            for (let i = period - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit' }));
                data.push(Math.floor(Math.random() * 10) + 1); // Demo veri
            }

            userGrowthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Yeni KullanÄ±cÄ±lar',
                        data: data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Ä°lan durumlarÄ± grafiÄŸi
        function initListingStatusChart() {
            const ctx = document.getElementById('listingStatusChart').getContext('2d');
            
            if (listingStatusChart) {
                listingStatusChart.destroy();
            }

            const activeListings = demoListings.filter(l => l.status === 'active').length;
            const pendingListings = demoListings.filter(l => l.status === 'pending').length;

            listingStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Aktif Ä°lanlar', 'Bekleyen Ä°lanlar'],
                    datasets: [{
                        data: [activeListings, pendingListings],
                        backgroundColor: ['#10b981', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Ã–deme gelirleri grafiÄŸi
        function initPaymentRevenueChart() {
            const ctx = document.getElementById('paymentRevenueChart').getContext('2d');
            
            if (paymentRevenueChart) {
                paymentRevenueChart.destroy();
            }

            // Demo veri - gerÃ§ek uygulamada API'den gelecek
            const months = ['Ocak', 'Åubat', 'Mart', 'Nisan', 'MayÄ±s', 'Haziran'];
            const revenue = [12000, 15000, 18000, 22000, 25000, 28000];

            paymentRevenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'AylÄ±k Gelir (â‚º)',
                        data: revenue,
                        backgroundColor: '#10b981',
                        borderColor: '#059669',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('tr-TR') + ' â‚º';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Rapor indir
        function exportReport() {
            const reportData = {
                totalUsers: demoUsers.length,
                pendingUsers: demoUsers.filter(u => u.status === 'pending').length,
                totalListings: demoListings.length,
                totalPayments: demoPayments.length,
                generatedAt: new Date().toLocaleString('tr-TR')
            };

            const reportText = `
GARAJBURADA.COM - ADMIN RAPORU
================================
Toplam KullanÄ±cÄ±: ${reportData.totalUsers}
Bekleyen KullanÄ±cÄ±: ${reportData.pendingUsers}
Toplam Ä°lan: ${reportData.totalListings}
Toplam Ã–deme: ${reportData.totalPayments}
Rapor Tarihi: ${reportData.generatedAt}
            `;

            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `garajburada-rapor-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);

            showAlert('Rapor baÅŸarÄ±yla indirildi!', 'success');
        }

        // Toplu iÅŸlem deÄŸiÅŸkenleri
        let bulkData = [];
        let selectedItems = new Set();

        // Toplu iÅŸlem verilerini yÃ¼kle
        function loadBulkData() {
            const actionType = document.getElementById('bulkActionType').value;
            if (!actionType) {
                showAlert('LÃ¼tfen iÅŸlem tÃ¼rÃ¼ seÃ§in!', 'error');
                return;
            }

            const container = document.getElementById('bulkTableContainer');
            const buttons = document.getElementById('bulkActionButtons');
            
            container.style.display = 'block';
            buttons.style.display = 'block';

            switch (actionType) {
                case 'users':
                    bulkData = [...demoUsers];
                    displayBulkUsers();
                    break;
                case 'listings':
                    bulkData = [...demoListings];
                    displayBulkListings();
                    break;
                case 'payments':
                    bulkData = [...demoPayments];
                    displayBulkPayments();
                    break;
            }

            showAlert(`${bulkData.length} Ã¶ÄŸe yÃ¼klendi`, 'success');
        }

        // Toplu kullanÄ±cÄ±larÄ± gÃ¶ster
        function displayBulkUsers() {
            const tbody = document.getElementById('bulkTableBody');
            tbody.innerHTML = '';

            bulkData.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="item-checkbox" value="${user.id}" onchange="toggleItemSelection(${user.id})"></td>
                    <td>${user.id}</td>
                    <td>${user.name || user.email}</td>
                    <td><span class="status status-${user.status}">${user.status === 'active' ? 'Aktif' : user.status === 'pending' ? 'Bekleyen' : 'Pasif'}</span></td>
                    <td>${user.createdAt}</td>
                    <td>
                        <button class="btn btn-small btn-success" onclick="toggleUserStatus(${user.id})">
                            ${user.status === 'active' ? 'PasifleÅŸtir' : 'AktifleÅŸtir'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Toplu ilanlarÄ± gÃ¶ster
        function displayBulkListings() {
            const tbody = document.getElementById('bulkTableBody');
            tbody.innerHTML = '';

            bulkData.forEach(listing => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="item-checkbox" value="${listing.id}" onchange="toggleItemSelection(${listing.id})"></td>
                    <td>${listing.id}</td>
                    <td>${listing.title}</td>
                    <td><span class="status status-${listing.status}">${listing.status === 'active' ? 'Aktif' : listing.status === 'rejected' ? 'Reddedildi' : 'Bekliyor'}</span></td>
                    <td>2025-07-28</td>
                    <td>
                        <button class="btn btn-small btn-info" onclick="viewListing(${listing.id})" style="margin-right: 5px;">
                            GÃ¶rÃ¼ntÃ¼le
                        </button>
                        <button class="btn btn-small btn-success" onclick="approveListing(${listing.id})">
                            ${listing.status === 'active' ? 'OnaylandÄ±' : 'Onayla'}
                        </button>
                        <button class="btn btn-small btn-danger" onclick="rejectListing(${listing.id})" ${listing.status === 'rejected' ? 'disabled' : ''}>
                            ${listing.status === 'rejected' ? 'Reddedildi' : 'Reddet'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Toplu Ã¶demeleri gÃ¶ster
        function displayBulkPayments() {
            const tbody = document.getElementById('bulkTableBody');
            tbody.innerHTML = '';

            bulkData.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="item-checkbox" value="${payment.id}" onchange="toggleItemSelection(${payment.id})"></td>
                    <td>${payment.id}</td>
                    <td>${payment.user}</td>
                    <td><span class="status status-${payment.status}">${payment.status === 'completed' ? 'TamamlandÄ±' : 'Bekliyor'}</span></td>
                    <td>${payment.date}</td>
                    <td>
                        <button class="btn btn-small btn-primary">Detay</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Ã–ÄŸe seÃ§imini deÄŸiÅŸtir
        function toggleItemSelection(id) {
            if (selectedItems.has(id)) {
                selectedItems.delete(id);
            } else {
                selectedItems.add(id);
            }
            updateSelectionInfo();
        }

        // TÃ¼mÃ¼nÃ¼ seÃ§/kaldÄ±r
        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                const id = parseInt(checkbox.value);
                if (selectAllCheckbox.checked) {
                    selectedItems.add(id);
                } else {
                    selectedItems.delete(id);
                }
            });
            
            updateSelectionInfo();
        }

        // TÃ¼mÃ¼nÃ¼ seÃ§
        function selectAllItems() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                selectedItems.add(parseInt(checkbox.value));
            });
            selectAllCheckbox.checked = true;
            updateSelectionInfo();
        }

        // SeÃ§imi kaldÄ±r
        function deselectAllItems() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectAllCheckbox.checked = false;
            selectedItems.clear();
            updateSelectionInfo();
        }

        // SeÃ§im bilgisini gÃ¼ncelle
        function updateSelectionInfo() {
            const info = document.getElementById('selectionInfo');
            const count = document.getElementById('selectedCount');
            
            count.textContent = selectedItems.size;
            
            if (selectedItems.size > 0) {
                info.style.display = 'block';
            } else {
                info.style.display = 'none';
            }
        }

        // Toplu aktifleÅŸtir
        function bulkActivate() {
            if (selectedItems.size === 0) {
                showAlert('LÃ¼tfen en az bir Ã¶ÄŸe seÃ§in!', 'error');
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            let updatedCount = 0;

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const user = demoUsers.find(u => u.id === id);
                    if (user && user.status !== 'active') {
                        user.status = 'active';
                        updatedCount++;
                    }
                } else if (actionType === 'listings') {
                    const listing = demoListings.find(l => l.id === id);
                    if (listing && listing.status !== 'active') {
                        listing.status = 'active';
                        updatedCount++;
                    }
                }
            });

            showAlert(`${updatedCount} Ã¶ÄŸe aktifleÅŸtirildi!`, 'success');
            loadBulkData(); // Tabloyu yenile
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Tek aktifleÅŸtir
        function singleActivate() {
            if (selectedItems.size !== 1) {
                showAlert('LÃ¼tfen sadece bir Ã¶ÄŸe seÃ§in!', 'error');
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            const selectedId = Array.from(selectedItems)[0];

            if (actionType === 'users') {
                const user = demoUsers.find(u => u.id === selectedId);
                if (user && user.status !== 'active') {
                    user.status = 'active';
                    showAlert(`KullanÄ±cÄ± ${user.name || user.email} aktifleÅŸtirildi!`, 'success');
                } else {
                    showAlert('Bu kullanÄ±cÄ± zaten aktif!', 'info');
                }
            } else if (actionType === 'listings') {
                const listing = demoListings.find(l => l.id === selectedId);
                if (listing && listing.status !== 'active') {
                    listing.status = 'active';
                    showAlert(`Ä°lan ${listing.title} onaylandÄ±!`, 'success');
                } else {
                    showAlert('Bu ilan zaten onaylÄ±!', 'info');
                }
            }

            loadBulkData(); // Tabloyu yenile
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Toplu pasifleÅŸtir
        function bulkDeactivate() {
            if (selectedItems.size === 0) {
                showAlert('LÃ¼tfen en az bir Ã¶ÄŸe seÃ§in!', 'error');
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            let updatedCount = 0;

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const user = demoUsers.find(u => u.id === id);
                    if (user && user.status === 'active') {
                        user.status = 'inactive';
                        updatedCount++;
                    }
                } else if (actionType === 'listings') {
                    const listing = demoListings.find(l => l.id === id);
                    if (listing && listing.status === 'active') {
                        listing.status = 'pending';
                        updatedCount++;
                    }
                }
            });

            showAlert(`${updatedCount} Ã¶ÄŸe pasifleÅŸtirildi!`, 'success');
            loadBulkData(); // Tabloyu yenile
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Toplu sil
        function bulkDelete() {
            if (selectedItems.size === 0) {
                showAlert('LÃ¼tfen en az bir Ã¶ÄŸe seÃ§in!', 'error');
                return;
            }

            if (!confirm(`${selectedItems.size} Ã¶ÄŸeyi silmek istediÄŸinizden emin misiniz?`)) {
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            let deletedCount = 0;

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const index = demoUsers.findIndex(u => u.id === id);
                    if (index !== -1) {
                        demoUsers.splice(index, 1);
                        deletedCount++;
                    }
                } else if (actionType === 'listings') {
                    const index = demoListings.findIndex(l => l.id === id);
                    if (index !== -1) {
                        demoListings.splice(index, 1);
                        deletedCount++;
                    }
                } else if (actionType === 'payments') {
                    const index = demoPayments.findIndex(p => p.id === id);
                    if (index !== -1) {
                        demoPayments.splice(index, 1);
                        deletedCount++;
                    }
                }
            });

            showAlert(`${deletedCount} Ã¶ÄŸe silindi!`, 'success');
            loadBulkData(); // Tabloyu yenile
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Toplu dÄ±ÅŸa aktar
        function bulkExport() {
            if (selectedItems.size === 0) {
                showAlert('LÃ¼tfen en az bir Ã¶ÄŸe seÃ§in!', 'error');
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            const selectedData = [];

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const user = demoUsers.find(u => u.id === id);
                    if (user) selectedData.push(user);
                } else if (actionType === 'listings') {
                    const listing = demoListings.find(l => l.id === id);
                    if (listing) selectedData.push(listing);
                } else if (actionType === 'payments') {
                    const payment = demoPayments.find(p => p.id === id);
                    if (payment) selectedData.push(payment);
                }
            });

            const dataStr = JSON.stringify(selectedData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `garajburada-${actionType}-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            window.URL.revokeObjectURL(url);

            showAlert(`${selectedData.length} Ã¶ÄŸe dÄ±ÅŸa aktarÄ±ldÄ±!`, 'success');
        }

        // Toplu mesaj gÃ¶nder
        function bulkSendMessage() {
            if (selectedItems.size === 0) {
                showAlert('LÃ¼tfen en az bir Ã¶ÄŸe seÃ§in!', 'error');
                return;
            }

            const message = prompt('GÃ¶ndermek istediÄŸiniz mesajÄ± yazÄ±n:');
            if (!message) return;

            const actionType = document.getElementById('bulkActionType').value;
            let sentCount = 0;

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const user = demoUsers.find(u => u.id === id);
                    if (user) sentCount++;
                }
            });

            showAlert(`${sentCount} kullanÄ±cÄ±ya mesaj gÃ¶nderildi!`, 'success');
        }

        // SÃ¼resi biten ilanlarÄ± yÃ¼kle
        async function loadExpiredListings() {
            document.getElementById('expiredLoading').style.display = 'block';
            document.getElementById('expiredTable').style.display = 'none';
            
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('http://localhost:8000/api/admin/expired-listings', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayExpiredListings(data.listings);
                } else {
                    // API Ã§alÄ±ÅŸmÄ±yorsa demo verileri kullan
                    const expiredListings = [
                        {
                            id: 1,
                            title: "2018 BMW 320i",
                            user_email: "ahmet@email.com",
                            price: "â‚º850,000",
                            expires_at: "2025-01-20",
                            status: "expired",
                            days_left: -5
                        },
                        {
                            id: 2,
                            title: "2019 Mercedes C200",
                            user_email: "mehmet@email.com",
                            price: "â‚º1,200,000",
                            expires_at: "2025-01-22",
                            status: "expired",
                            days_left: -3
                        },
                        {
                            id: 3,
                            title: "2020 Audi A4",
                            user_email: "ayse@email.com",
                            price: "â‚º950,000",
                            expires_at: "2025-01-25",
                            status: "expired",
                            days_left: 0
                        },
                        {
                            id: 4,
                            title: "2017 Volkswagen Golf",
                            user_email: "fatma@email.com",
                            price: "â‚º450,000",
                            expires_at: "2025-01-28",
                            status: "expired",
                            days_left: 3
                        }
                    ];
                    displayExpiredListings(expiredListings);
                }
            } catch (error) {
                console.log("API hatasÄ±, demo veriler kullanÄ±lÄ±yor:", error);
                // Demo veriler
                const expiredListings = [
                    {
                        id: 1,
                        title: "2018 BMW 320i",
                        user_email: "ahmet@email.com",
                        price: "â‚º850,000",
                        expires_at: "2025-01-20",
                        status: "expired",
                        days_left: -5
                    },
                    {
                        id: 2,
                        title: "2019 Mercedes C200",
                        user_email: "mehmet@email.com",
                        price: "â‚º1,200,000",
                        expires_at: "2025-01-22",
                        status: "expired",
                        days_left: -3
                    },
                    {
                        id: 3,
                        title: "2020 Audi A4",
                        user_email: "ayse@email.com",
                        price: "â‚º950,000",
                        expires_at: "2025-01-25",
                        status: "expired",
                        days_left: 0
                    },
                    {
                        id: 4,
                        title: "2017 Volkswagen Golf",
                        user_email: "fatma@email.com",
                        price: "â‚º450,000",
                        expires_at: "2025-01-28",
                        status: "expired",
                        days_left: 3
                    }
                ];
                displayExpiredListings(expiredListings);
            }
        }

        // SÃ¼resi biten ilanlarÄ± gÃ¶ster
        function displayExpiredListings(listings) {
            const tbody = document.getElementById('expiredTableBody');
            tbody.innerHTML = '';
            
            listings.forEach(listing => {
                const daysLeftText = listing.days_left < 0 ? 
                    `${Math.abs(listing.days_left)} gÃ¼n Ã¶nce bitti` : 
                    listing.days_left === 0 ? 'BugÃ¼n bitiyor' : 
                    `${listing.days_left} gÃ¼n kaldÄ±`;
                
                const daysLeftClass = listing.days_left < 0 ? 'status-expired' : 
                                    listing.days_left === 0 ? 'status-pending' : 
                                    'status-active';
                
                const row = `
                    <tr>
                        <td>${listing.id}</td>
                        <td>${listing.title}</td>
                        <td>${listing.user_email}</td>
                        <td>${listing.price}</td>
                        <td>${listing.expires_at}</td>
                        <td><span class="status ${daysLeftClass}">${daysLeftText}</span></td>
                        <td><span class="status status-expired">SÃ¼resi Bitti</span></td>
                        <td>
                            <button class="btn btn-small btn-info" onclick="viewExpiredListing(${listing.id})" style="margin-right: 5px;">
                                GÃ¶rÃ¼ntÃ¼le
                            </button>
                            <button class="btn btn-small btn-success" onclick="extendListing(${listing.id})" style="margin-right: 5px;">
                                Uzat
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteExpiredListing(${listing.id})">
                                Sil
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            document.getElementById('expiredLoading').style.display = 'none';
            document.getElementById('expiredTable').style.display = 'table';
        }

        // SÃ¼resi biten ilanlarÄ± filtrele
        function filterExpiredListings() {
            const filter = document.getElementById('expiredFilter').value;
            loadExpiredListings(); // Åimdilik tÃ¼mÃ¼nÃ¼ gÃ¶ster, gerÃ§ek uygulamada filtreleme yapÄ±lacak
            showAlert(`${filter} filtresi uygulandÄ±!`, 'success');
        }

        // Ä°lan sÃ¼resini uzat
        async function extendListing(listingId) {
            const days = prompt('KaÃ§ gÃ¼n uzatmak istiyorsunuz?', '30');
            if (days && !isNaN(days)) {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`http://localhost:8000/api/admin/listings/${listingId}/extend?days=${days}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        showAlert(result.message, 'success');
                        loadExpiredListings(); // Tabloyu yenile
                    } else {
                        showAlert('Ä°lan sÃ¼resi uzatÄ±lamadÄ±!', 'error');
                    }
                } catch (error) {
                    console.log("API hatasÄ±:", error);
                    showAlert(`Ä°lan ${listingId} sÃ¼resi ${days} gÃ¼n uzatÄ±ldÄ±! (Demo)`, 'success');
                    loadExpiredListings(); // Tabloyu yenile
                }
            }
        }

        // SÃ¼resi biten ilanÄ± sil
        function deleteExpiredListing(listingId) {
            if (confirm(`Ä°lan ${listingId} silinecek. Bu iÅŸlem geri alÄ±namaz. Devam etmek istiyor musunuz?`)) {
                showAlert(`Ä°lan ${listingId} silindi!`, 'success');
                loadExpiredListings(); // Tabloyu yenile
            }
        }

        // TÃ¼m sÃ¼resi biten ilanlarÄ± uzat
        async function extendAllExpired() {
            const days = prompt('TÃ¼m sÃ¼resi biten ilanlarÄ± kaÃ§ gÃ¼n uzatmak istiyorsunuz?', '30');
            if (days && !isNaN(days)) {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`http://localhost:8000/api/admin/listings/extend-all-expired?days=${days}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        showAlert(result.message, 'success');
                        loadExpiredListings(); // Tabloyu yenile
                    } else {
                        showAlert('Ä°lanlar uzatÄ±lamadÄ±!', 'error');
                    }
                } catch (error) {
                    console.log("API hatasÄ±:", error);
                    showAlert(`TÃ¼m sÃ¼resi biten ilanlar ${days} gÃ¼n uzatÄ±ldÄ±! (Demo)`, 'success');
                    loadExpiredListings(); // Tabloyu yenile
                }
            }
        }

        // TÃ¼m sÃ¼resi biten ilanlarÄ± sil
        function deleteAllExpired() {
            if (confirm('TÃ¼m sÃ¼resi biten ilanlar silinecek. Bu iÅŸlem geri alÄ±namaz. Devam etmek istiyor musunuz?')) {
                showAlert('TÃ¼m sÃ¼resi biten ilanlar silindi!', 'success');
                loadExpiredListings(); // Tabloyu yenile
            }
        }

        // SÃ¼resi biten ilanÄ± gÃ¶rÃ¼ntÃ¼le
        function viewExpiredListing(listingId) {
            const listing = demoListings.find(l => l.id === listingId);
            if (listing) {
                const details = `
                    <strong>Ä°lan DetaylarÄ±:</strong><br>
                    <strong>ID:</strong> ${listing.id}<br>
                    <strong>BaÅŸlÄ±k:</strong> ${listing.title}<br>
                    <strong>KullanÄ±cÄ±:</strong> ${listing.user}<br>
                    <strong>Fiyat:</strong> ${listing.price}<br>
                    <strong>Durum:</strong> SÃ¼resi Bitti<br>
                    <strong>OluÅŸturulma:</strong> ${listing.created_at || '2025-01-15'}
                `;

                if (confirm(details + '\n\nBu ilanÄ± detaylÄ± gÃ¶rÃ¼ntÃ¼lemek istiyor musunuz?')) {
                    window.open(`/listing/${listing.id}`, '_blank');
                }
            }
        }

        // Sayfa yÃ¼klendiÄŸinde kullanÄ±cÄ±larÄ± yÃ¼kle
        window.onload = function() {
            loadUsers();
            updateStats();
            updateCharts(); // Grafikleri yÃ¼kle
        };
    </script>
</body>
</html> 