<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Garajburada.com</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            font-size: 14px;
        }

        .header {
            background: #1e293b;
            color: white;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            font-size: 24px;
        }

        .brand {
            font-size: 18px;
            font-weight: bold;
        }

        .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            text-decoration: none;
            color: white;
        }

        .btn-primary { background: #3b82f6; }
        .btn-success { background: #10b981; }
        .btn-danger { background: #ef4444; }
        .btn-info { background: #06b6d4; }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }

        .tab {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            font-size: 14px;
        }

        .tab.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: bold;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .card h3 {
            margin-bottom: 1rem;
            color: #1f2937;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th, td {
            padding: 0.5rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }

        th {
            background: #f9fafb;
            font-weight: bold;
        }

        .status {
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }

        .status-pending { background: #fee2e2; color: #991b1b; }
        .status-active { background: #d1fae5; color: #065f46; }
        .status-inactive { background: #fee2e2; color: #991b1b; }
        .status-rejected { background: #fecaca; color: #dc2626; }

        .role {
            padding: 0.25rem 0.5rem;
            border-radius: 3px;
            font-size: 11px;
            font-weight: bold;
        }

        .role-user { background: #e0e7ff; color: #3730a3; }
        .role-moderator { background: #fef3c7; color: #92400e; }
        .role-admin { background: #dcfce7; color: #166534; }
        .role-superadmin { background: #fce7f3; color: #be185d; }

        .btn-small {
            padding: 0.25rem 0.5rem;
            font-size: 11px;
            margin: 0 0.25rem;
        }

        .alert {
            padding: 0.75rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            font-size: 12px;
        }

        .alert-success { background: #d1fae5; color: #065f46; }
        .alert-error { background: #fee2e2; color: #991b1b; }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <span class="logo-icon">üöó</span>
            <span class="brand">Garajburada.com - Admin Panel</span>
        </div>
        <div class="nav-buttons">
            <button class="btn btn-primary" onclick="refreshData()">Yenile</button>
            <button class="btn btn-danger" onclick="logout()">√áƒ±kƒ±≈ü</button>
        </div>
    </div>

    <div class="container">
        <div id="alert" class="alert" style="display: none;"></div>

        <!-- Dashboard ƒ∞statistikleri -->
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
            <div class="stat-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 2rem; color: #3b82f6; margin-bottom: 0.5rem;">üë•</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;" id="totalUsers">-</div>
                <div style="font-size: 0.8rem; color: #6b7280;">Toplam Kullanƒ±cƒ±</div>
            </div>
            <div class="stat-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 2rem; color: #ef4444; margin-bottom: 0.5rem;">‚è≥</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;" id="pendingUsers">-</div>
                <div style="font-size: 0.8rem; color: #6b7280;">Bekleyen Kullanƒ±cƒ±</div>
            </div>
            <div class="stat-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 2rem; color: #10b981; margin-bottom: 0.5rem;">üìã</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;" id="totalListings">-</div>
                <div style="font-size: 0.8rem; color: #6b7280;">Toplam ƒ∞lan</div>
            </div>
            <div class="stat-card" style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center;">
                <div style="font-size: 2rem; color: #f59e0b; margin-bottom: 0.5rem;">üí∞</div>
                <div style="font-size: 1.5rem; font-weight: bold; color: #1f2937;" id="totalPayments">-</div>
                <div style="font-size: 0.8rem; color: #6b7280;">Toplam √ñdeme</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="showTab('users')">Kullanƒ±cƒ±lar</div>
            <div class="tab" onclick="showTab('listings')">ƒ∞lanlar</div>
            <div class="tab" onclick="showTab('expired')">S√ºresi Biten ƒ∞lanlar</div>
            <div class="tab" onclick="showTab('payments')">√ñdemeler</div>
            <div class="tab" onclick="showTab('analytics')">Grafikler</div>
            <div class="tab" onclick="showTab('bulk')">Toplu ƒ∞≈ülemler</div>
        </div>

        <!-- Kullanƒ±cƒ±lar Tab -->
        <div id="users" class="tab-content active">
            <div class="card">
                <h3>Kullanƒ±cƒ± Y√∂netimi</h3>
                
                <!-- Arama ve Filtreleme -->
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                    <input type="text" id="userSearch" placeholder="Kullanƒ±cƒ± ara..." style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px; flex: 1;">
                    <select id="roleFilter" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="">T√ºm Roller</option>
                        <option value="user">Kullanƒ±cƒ±</option>
                        <option value="moderator">Moderat√∂r</option>
                        <option value="admin">Admin</option>
                        <option value="superadmin">S√ºper Admin</option>
                    </select>
                    <select id="statusFilter" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="">T√ºm Durumlar</option>
                        <option value="active">Aktif</option>
                        <option value="pending">Bekleyen</option>
                        <option value="inactive">Pasif</option>
                    </select>
                    <button class="btn btn-primary" onclick="filterUsers()">Filtrele</button>
                    <button class="btn btn-primary" onclick="clearUserFilters()">Temizle</button>
                </div>
                
                <div id="usersLoading" class="loading">Kullanƒ±cƒ±lar y√ºkleniyor...</div>
                <table id="usersTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Email</th>
                            <th>Ad</th>
                            <th>Rol</th>
                            <th>Durum</th>
                            <th>Kayƒ±t Tarihi</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- ƒ∞lanlar Tab -->
        <div id="listings" class="tab-content">
            <div class="card">
                <h3>ƒ∞lan Y√∂netimi</h3>
                <div id="listingsLoading" class="loading">ƒ∞lanlar y√ºkleniyor...</div>
                <table id="listingsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ba≈ülƒ±k</th>
                            <th>Kullanƒ±cƒ±</th>
                            <th>Fiyat</th>
                            <th>Durum</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="listingsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- S√ºresi Biten ƒ∞lanlar Tab -->
        <div id="expired" class="tab-content">
            <div class="card">
                <h3>S√ºresi Biten ƒ∞lanlar</h3>
                
                <!-- Filtreleme Se√ßenekleri -->
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                    <select id="expiredFilter" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="all">T√ºm S√ºresi Biten ƒ∞lanlar</option>
                        <option value="today">Bug√ºn S√ºresi Bitenler</option>
                        <option value="week">Bu Hafta S√ºresi Bitenler</option>
                        <option value="month">Bu Ay S√ºresi Bitenler</option>
                    </select>
                    <button class="btn btn-primary" onclick="filterExpiredListings()">Filtrele</button>
                    <button class="btn btn-success" onclick="extendAllExpired()">T√ºm√ºn√º Uzat</button>
                    <button class="btn btn-danger" onclick="deleteAllExpired()">T√ºm√ºn√º Sil</button>
                </div>
                
                <div id="expiredLoading" class="loading">S√ºresi biten ilanlar y√ºkleniyor...</div>
                <table id="expiredTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Ba≈ülƒ±k</th>
                            <th>Kullanƒ±cƒ±</th>
                            <th>Fiyat</th>
                            <th>Biti≈ü Tarihi</th>
                            <th>Kalan S√ºre</th>
                            <th>Durum</th>
                            <th>ƒ∞≈ülemler</th>
                        </tr>
                    </thead>
                    <tbody id="expiredTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- √ñdemeler Tab -->
        <div id="payments" class="tab-content">
            <div class="card">
                <h3>√ñdeme Y√∂netimi</h3>
                <div id="paymentsLoading" class="loading">√ñdemeler y√ºkleniyor...</div>
                <table id="paymentsTable" style="display: none;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Kullanƒ±cƒ±</th>
                            <th>Tutar</th>
                            <th>A√ßƒ±klama</th>
                            <th>Durum</th>
                            <th>Tarih</th>
                        </tr>
                    </thead>
                    <tbody id="paymentsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- Grafikler Tab -->
        <div id="analytics" class="tab-content">
            <div class="card">
                <h3>Analitik ve Raporlar</h3>
                
                <!-- Grafik Kontrolleri -->
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                    <select id="chartPeriod" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="7">Son 7 G√ºn</option>
                        <option value="30" selected>Son 30 G√ºn</option>
                        <option value="90">Son 3 Ay</option>
                        <option value="365">Son 1 Yƒ±l</option>
                    </select>
                    <button class="btn btn-primary" onclick="updateCharts()">Grafikleri G√ºncelle</button>
                    <button class="btn btn-success" onclick="exportReport()">Rapor ƒ∞ndir</button>
                </div>

                <!-- Grafik Grid -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <!-- Kullanƒ±cƒ± Artƒ±≈ü Grafiƒüi -->
                    <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="margin-bottom: 1rem; color: #1f2937;">Kullanƒ±cƒ± Artƒ±≈üƒ±</h4>
                        <canvas id="userGrowthChart" width="400" height="200"></canvas>
                    </div>
                    
                    <!-- ƒ∞lan ƒ∞statistikleri -->
                    <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4 style="margin-bottom: 1rem; color: #1f2937;">ƒ∞lan Durumlarƒ±</h4>
                        <canvas id="listingStatusChart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- √ñdeme Grafiƒüi -->
                <div style="background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <h4 style="margin-bottom: 1rem; color: #1f2937;">Aylƒ±k √ñdeme Gelirleri</h4>
                    <canvas id="paymentRevenueChart" width="800" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Toplu ƒ∞≈ülemler Tab -->
        <div id="bulk" class="tab-content">
            <div class="card">
                <h3>Toplu ƒ∞≈ülemler</h3>
                
                <!-- ƒ∞≈ülem Se√ßimi -->
                <div style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
                    <select id="bulkActionType" style="padding: 0.5rem; border: 1px solid #e5e7eb; border-radius: 5px;">
                        <option value="">ƒ∞≈ülem T√ºr√º Se√ßin</option>
                        <option value="users">Kullanƒ±cƒ± ƒ∞≈ülemleri</option>
                        <option value="listings">ƒ∞lan ƒ∞≈ülemleri</option>
                        <option value="payments">√ñdeme ƒ∞≈ülemleri</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadBulkData()">Verileri Y√ºkle</button>
                    <button class="btn btn-success" onclick="selectAllItems()">T√ºm√ºn√º Se√ß</button>
                    <button class="btn btn-primary" onclick="deselectAllItems()">Se√ßimi Kaldƒ±r</button>
                </div>

                <!-- Toplu ƒ∞≈ülem Butonlarƒ± -->
                <div id="bulkActionButtons" style="margin-bottom: 1rem; display: none;">
                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <button class="btn btn-success" onclick="bulkActivate()">Toplu Aktifle≈ütir</button>
                        <button class="btn btn-success" onclick="singleActivate()">Tek Aktifle≈ütir</button>
                        <button class="btn btn-danger" onclick="bulkDeactivate()">Toplu Pasifle≈ütir</button>
                        <button class="btn btn-primary" onclick="bulkDelete()">Toplu Sil</button>
                        <button class="btn btn-success" onclick="bulkExport()">Toplu Dƒ±≈üa Aktar</button>
                        <button class="btn btn-primary" onclick="bulkSendMessage()">Toplu Mesaj G√∂nder</button>
                    </div>
                </div>

                <!-- Se√ßim Bilgisi -->
                <div id="selectionInfo" style="margin-bottom: 1rem; padding: 0.5rem; background: #f3f4f6; border-radius: 5px; display: none;">
                    <span id="selectedCount">0</span> √∂ƒüe se√ßildi
                </div>

                <!-- Toplu ƒ∞≈ülem Tablosu -->
                <div id="bulkTableContainer" style="display: none;">
                    <table id="bulkTable" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                        <thead>
                            <tr>
                                <th style="width: 30px;">
                                    <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()">
                                </th>
                                <th>ID</th>
                                <th>Ad/Email</th>
                                <th>Durum</th>
                                <th>Tarih</th>
                                <th>ƒ∞≈ülemler</th>
                            </tr>
                        </thead>
                        <tbody id="bulkTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Demo veriler
        const demoUsers = [
            { id: 1, email: 'admin@garajburada.com', name: 'Admin User', role: 'superadmin', status: 'active', createdAt: '2025-07-28' },
            { id: 2, email: 'moderator@garajburada.com', name: 'Moderator User', role: 'moderator', status: 'active', createdAt: '2025-07-28' },
            { id: 3, email: 'user@garajburada.com', name: 'Normal User', role: 'user', status: 'active', createdAt: '2025-07-28' },
            { id: 4, email: 'bekirelbeyoglu27@gmail.com', name: 'bekirelbeyoƒülu', role: 'user', status: 'pending', createdAt: '2025-07-28' },
            { id: 5, email: 'jane.smith@example.com', name: 'Jane Smith', role: 'user', status: 'pending', createdAt: '2025-04-05' }
        ];

        const demoListings = [
            { id: 1, title: '2020 BMW 3 Serisi', user: 'user@garajburada.com', price: '850.000 ‚Ç∫', status: 'active' },
            { id: 2, title: '2019 Mercedes C Serisi', user: 'user@garajburada.com', price: '920.000 ‚Ç∫', status: 'pending' },
            { id: 3, title: '2021 Audi A4', user: 'user@garajburada.com', price: '780.000 ‚Ç∫', status: 'active' }
        ];

        const demoPayments = [
            { id: 1, user: 'user@garajburada.com', amount: '800 ‚Ç∫', description: 'Premium ƒ∞lan', status: 'completed', date: '2025-07-28' },
            { id: 2, user: 'user@garajburada.com', amount: '1200 ‚Ç∫', description: 'Premium Plus ƒ∞lan', status: 'pending', date: '2025-07-28' }
        ];

        // Tab deƒüi≈ütirme
        function showTab(tabName) {
            // T√ºm tablarƒ± gizle
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Se√ßili tabƒ± g√∂ster
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            // Tab i√ßeriƒüini y√ºkle
            if (tabName === 'users') {
                loadUsers();
            } else if (tabName === 'listings') {
                loadListings();
            } else if (tabName === 'expired') {
                loadExpiredListings();
            } else if (tabName === 'payments') {
                loadPayments();
            }
        }

        // Kullanƒ±cƒ±larƒ± y√ºkle
        async function loadUsers() {
            const loading = document.getElementById('usersLoading');
            const table = document.getElementById('usersTable');

            loading.style.display = 'block';
            table.style.display = 'none';

            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('http://localhost:8000/api/admin/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                } else {
                    // API √ßalƒ±≈ümƒ±yorsa demo verileri kullan
                    displayUsers(demoUsers);
                }
            } catch (error) {
                console.log("API hatasƒ±, demo veriler kullanƒ±lƒ±yor:", error);
                displayUsers(demoUsers);
            }

            loading.style.display = 'none';
            table.style.display = 'table';
        }

        // Kullanƒ±cƒ±larƒ± g√∂ster
        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.email}</td>
                    <td>${user.name || '-'}</td>
                    <td><span class="role role-${user.role}">${user.role}</span></td>
                    <td><span class="status status-${user.status}">${user.status === 'active' ? 'Aktif' : user.status === 'pending' ? 'Bekleyen' : 'Pasif'}</span></td>
                    <td>${user.createdAt}</td>
                    <td>
                        <button class="btn btn-small btn-success" onclick="toggleUserStatus(${user.id})" ${user.status === 'active' ? 'disabled' : ''}>
                            ${user.status === 'active' ? 'Aktif' : 'Aktifle≈ütir'}
                        </button>
                        <button class="btn btn-small btn-primary" onclick="changeUserRole(${user.id})">
                            Rol Deƒüi≈ütir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Kullanƒ±cƒ± durumu deƒüi≈ütir
        async function toggleUserStatus(userId) {
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch(`http://localhost:8000/api/admin/users/${userId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: 'active' })
                });

                if (response.ok) {
                    showAlert('Kullanƒ±cƒ± ba≈üarƒ±yla aktifle≈ütirildi!', 'success');
                    loadUsers();
                } else {
                    // Demo modda g√ºncelle
                    const user = demoUsers.find(u => u.id === userId);
                    if (user) {
                        user.status = 'active';
                        showAlert(`Kullanƒ±cƒ± ${user.name || user.email} aktifle≈ütirildi!`, 'success');
                        displayUsers(demoUsers);
                    }
                }
            } catch (error) {
                // Demo modda g√ºncelle
                const user = demoUsers.find(u => u.id === userId);
                if (user) {
                    user.status = 'active';
                    showAlert(`Kullanƒ±cƒ± ${user.name || user.email} aktifle≈ütirildi!`, 'success');
                    displayUsers(demoUsers);
                }
            }
        }

        // Kullanƒ±cƒ± rol√º deƒüi≈ütir
        function changeUserRole(userId) {
            const user = demoUsers.find(u => u.id === userId);
            if (!user) return;

            const roles = ['user', 'moderator', 'admin', 'superadmin'];
            const currentIndex = roles.indexOf(user.role);
            const nextIndex = (currentIndex + 1) % roles.length;
            const newRole = roles[nextIndex];

            user.role = newRole;
            showAlert(`Kullanƒ±cƒ± ${user.name || user.email} rol√º ${newRole} olarak deƒüi≈ütirildi!`, 'success');
            displayUsers(demoUsers);
        }

        // ƒ∞lanlarƒ± y√ºkle
        function loadListings() {
            const loading = document.getElementById('listingsLoading');
            const table = document.getElementById('listingsTable');

            loading.style.display = 'block';
            table.style.display = 'none';

            setTimeout(() => {
                displayListings(demoListings);
                loading.style.display = 'none';
                table.style.display = 'table';
            }, 500);
        }

        // ƒ∞lanlarƒ± g√∂ster
        function displayListings(listings) {
            const tbody = document.getElementById('listingsTableBody');
            tbody.innerHTML = '';

            listings.forEach(listing => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${listing.id}</td>
                    <td>${listing.title}</td>
                    <td>${listing.user}</td>
                    <td>${listing.price}</td>
                    <td><span class="status status-${listing.status}">${listing.status === 'active' ? 'Aktif' : listing.status === 'rejected' ? 'Reddedildi' : 'Bekliyor'}</span></td>
                    <td>
                        <button class="btn btn-small btn-info" onclick="viewListing(${listing.id})" style="margin-right: 5px;">
                            G√∂r√ºnt√ºle
                        </button>
                        <button class="btn btn-small btn-success" onclick="approveListing(${listing.id})" ${listing.status === 'active' ? 'disabled' : ''}>
                            ${listing.status === 'active' ? 'Onaylandƒ±' : 'Onayla'}
                        </button>
                        <button class="btn btn-small btn-danger" onclick="rejectListing(${listing.id})" ${listing.status === 'rejected' ? 'disabled' : ''}>
                            ${listing.status === 'rejected' ? 'Reddedildi' : 'Reddet'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ƒ∞lan g√∂r√ºnt√ºle
        function viewListing(listingId) {
            const listing = demoListings.find(l => l.id === listingId);
            if (listing) {
                const statusText = listing.status === 'active' ? 'Aktif' : 
                                  listing.status === 'rejected' ? 'Reddedildi' : 'Bekliyor';
                const details = `
                    <strong>ƒ∞lan Detaylarƒ±:</strong><br>
                    <strong>ID:</strong> ${listing.id}<br>
                    <strong>Ba≈ülƒ±k:</strong> ${listing.title}<br>
                    <strong>Kullanƒ±cƒ±:</strong> ${listing.user}<br>
                    <strong>Fiyat:</strong> ${listing.price}<br>
                    <strong>Durum:</strong> ${statusText}<br>
                    <strong>Olu≈üturulma:</strong> ${listing.created_at || '2025-07-28'}
                `;
                
                // Modal veya alert ile g√∂ster
                if (confirm(details + '\n\nBu ilanƒ± detaylƒ± g√∂r√ºnt√ºlemek istiyor musunuz?')) {
                    // Ger√ßek uygulamada yeni sayfa a√ßƒ±labilir
                    window.open(`/listing/${listing.id}`, '_blank');
                }
            }
        }

        // ƒ∞lan onayla
        function approveListing(listingId) {
            const listing = demoListings.find(l => l.id === listingId);
            if (listing) {
                listing.status = 'active';
                showAlert(`ƒ∞lan ${listing.title} onaylandƒ±!`, 'success');
                displayListings(demoListings);
            }
        }

        // ƒ∞lan reddet
        function rejectListing(listingId) {
            const listing = demoListings.find(l => l.id === listingId);
            if (listing) {
                if (confirm(`ƒ∞lan "${listing.title}" reddedilecek. Bu i≈ülem geri alƒ±namaz. Devam etmek istiyor musunuz?`)) {
                    listing.status = 'rejected';
                    showAlert(`ƒ∞lan ${listing.title} reddedildi!`, 'error');
                    displayListings(demoListings);
                }
            }
        }

        // √ñdemeleri y√ºkle
        function loadPayments() {
            const loading = document.getElementById('paymentsLoading');
            const table = document.getElementById('paymentsTable');

            loading.style.display = 'block';
            table.style.display = 'none';

            setTimeout(() => {
                displayPayments(demoPayments);
                loading.style.display = 'none';
                table.style.display = 'table';
            }, 500);
        }

        // √ñdemeleri g√∂ster
        function displayPayments(payments) {
            const tbody = document.getElementById('paymentsTableBody');
            tbody.innerHTML = '';

            payments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.id}</td>
                    <td>${payment.user}</td>
                    <td>${payment.amount}</td>
                    <td>${payment.description}</td>
                    <td><span class="status status-${payment.status}">${payment.status === 'completed' ? 'Tamamlandƒ±' : 'Bekliyor'}</span></td>
                    <td>${payment.date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Alert g√∂ster
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';

            setTimeout(() => {
                alert.style.display = 'none';
            }, 3000);
        }

        // Kullanƒ±cƒ± filtreleme
        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            
            const filteredUsers = demoUsers.filter(user => {
                const matchesSearch = user.name?.toLowerCase().includes(searchTerm) || 
                                    user.email.toLowerCase().includes(searchTerm);
                const matchesRole = !roleFilter || user.role === roleFilter;
                const matchesStatus = !statusFilter || user.status === statusFilter;
                
                return matchesSearch && matchesRole && matchesStatus;
            });
            
            displayUsers(filteredUsers);
            showAlert(`${filteredUsers.length} kullanƒ±cƒ± bulundu`, 'success');
        }

        // Filtreleri temizle
        function clearUserFilters() {
            document.getElementById('userSearch').value = '';
            document.getElementById('roleFilter').value = '';
            document.getElementById('statusFilter').value = '';
            displayUsers(demoUsers);
            showAlert('Filtreler temizlendi', 'success');
        }

        // Verileri yenile
        function refreshData() {
            showAlert('Veriler yenileniyor...', 'success');
            loadUsers();
            updateStats();
        }

        // √áƒ±kƒ±≈ü yap
        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userRole');
            window.location.href = 'login.html';
        }

        // ƒ∞statistikleri g√ºncelle
        function updateStats() {
            // Kullanƒ±cƒ± istatistikleri
            document.getElementById('totalUsers').textContent = demoUsers.length;
            document.getElementById('pendingUsers').textContent = demoUsers.filter(u => u.status === 'pending').length;
            
            // ƒ∞lan istatistikleri
            document.getElementById('totalListings').textContent = demoListings.length;
            
            // √ñdeme istatistikleri
            document.getElementById('totalPayments').textContent = demoPayments.length;
        }

        // Grafik deƒüi≈ükenleri
        let userGrowthChart, listingStatusChart, paymentRevenueChart;

        // Grafikleri g√ºncelle
        function updateCharts() {
            const period = document.getElementById('chartPeriod').value;
            initUserGrowthChart(period);
            initListingStatusChart();
            initPaymentRevenueChart();
        }

        // Kullanƒ±cƒ± artƒ±≈ü grafiƒüi
        function initUserGrowthChart(period = 30) {
            const ctx = document.getElementById('userGrowthChart').getContext('2d');
            
            if (userGrowthChart) {
                userGrowthChart.destroy();
            }

            // Demo veri - ger√ßek uygulamada API'den gelecek
            const labels = [];
            const data = [];
            const today = new Date();
            
            for (let i = period - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit' }));
                data.push(Math.floor(Math.random() * 10) + 1); // Demo veri
            }

            userGrowthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Yeni Kullanƒ±cƒ±lar',
                        data: data,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // ƒ∞lan durumlarƒ± grafiƒüi
        function initListingStatusChart() {
            const ctx = document.getElementById('listingStatusChart').getContext('2d');
            
            if (listingStatusChart) {
                listingStatusChart.destroy();
            }

            const activeListings = demoListings.filter(l => l.status === 'active').length;
            const pendingListings = demoListings.filter(l => l.status === 'pending').length;

            listingStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Aktif ƒ∞lanlar', 'Bekleyen ƒ∞lanlar'],
                    datasets: [{
                        data: [activeListings, pendingListings],
                        backgroundColor: ['#10b981', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // √ñdeme gelirleri grafiƒüi
        function initPaymentRevenueChart() {
            const ctx = document.getElementById('paymentRevenueChart').getContext('2d');
            
            if (paymentRevenueChart) {
                paymentRevenueChart.destroy();
            }

            // Demo veri - ger√ßek uygulamada API'den gelecek
            const months = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran'];
            const revenue = [12000, 15000, 18000, 22000, 25000, 28000];

            paymentRevenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Aylƒ±k Gelir (‚Ç∫)',
                        data: revenue,
                        backgroundColor: '#10b981',
                        borderColor: '#059669',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString('tr-TR') + ' ‚Ç∫';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Rapor indir
        function exportReport() {
            const reportData = {
                totalUsers: demoUsers.length,
                pendingUsers: demoUsers.filter(u => u.status === 'pending').length,
                totalListings: demoListings.length,
                totalPayments: demoPayments.length,
                generatedAt: new Date().toLocaleString('tr-TR')
            };

            const reportText = `
GARAJBURADA.COM - ADMIN RAPORU
================================
Toplam Kullanƒ±cƒ±: ${reportData.totalUsers}
Bekleyen Kullanƒ±cƒ±: ${reportData.pendingUsers}
Toplam ƒ∞lan: ${reportData.totalListings}
Toplam √ñdeme: ${reportData.totalPayments}
Rapor Tarihi: ${reportData.generatedAt}
            `;

            const blob = new Blob([reportText], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `garajburada-rapor-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);

            showAlert('Rapor ba≈üarƒ±yla indirildi!', 'success');
        }

        // Toplu i≈ülem deƒüi≈ükenleri
        let bulkData = [];
        let selectedItems = new Set();

        // Toplu i≈ülem verilerini y√ºkle
        function loadBulkData() {
            const actionType = document.getElementById('bulkActionType').value;
            if (!actionType) {
                showAlert('L√ºtfen i≈ülem t√ºr√º se√ßin!', 'error');
                return;
            }

            const container = document.getElementById('bulkTableContainer');
            const buttons = document.getElementById('bulkActionButtons');
            
            container.style.display = 'block';
            buttons.style.display = 'block';

            switch (actionType) {
                case 'users':
                    bulkData = [...demoUsers];
                    displayBulkUsers();
                    break;
                case 'listings':
                    bulkData = [...demoListings];
                    displayBulkListings();
                    break;
                case 'payments':
                    bulkData = [...demoPayments];
                    displayBulkPayments();
                    break;
            }

            showAlert(`${bulkData.length} √∂ƒüe y√ºklendi`, 'success');
        }

        // Toplu kullanƒ±cƒ±larƒ± g√∂ster
        function displayBulkUsers() {
            const tbody = document.getElementById('bulkTableBody');
            tbody.innerHTML = '';

            bulkData.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="item-checkbox" value="${user.id}" onchange="toggleItemSelection(${user.id})"></td>
                    <td>${user.id}</td>
                    <td>${user.name || user.email}</td>
                    <td><span class="status status-${user.status}">${user.status === 'active' ? 'Aktif' : user.status === 'pending' ? 'Bekleyen' : 'Pasif'}</span></td>
                    <td>${user.createdAt}</td>
                    <td>
                        <button class="btn btn-small btn-success" onclick="toggleUserStatus(${user.id})">
                            ${user.status === 'active' ? 'Pasifle≈ütir' : 'Aktifle≈ütir'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Toplu ilanlarƒ± g√∂ster
        function displayBulkListings() {
            const tbody = document.getElementById('bulkTableBody');
            tbody.innerHTML = '';

            bulkData.forEach(listing => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="item-checkbox" value="${listing.id}" onchange="toggleItemSelection(${listing.id})"></td>
                    <td>${listing.id}</td>
                    <td>${listing.title}</td>
                    <td><span class="status status-${listing.status}">${listing.status === 'active' ? 'Aktif' : listing.status === 'rejected' ? 'Reddedildi' : 'Bekliyor'}</span></td>
                    <td>2025-07-28</td>
                    <td>
                        <button class="btn btn-small btn-info" onclick="viewListing(${listing.id})" style="margin-right: 5px;">
                            G√∂r√ºnt√ºle
                        </button>
                        <button class="btn btn-small btn-success" onclick="approveListing(${listing.id})">
                            ${listing.status === 'active' ? 'Onaylandƒ±' : 'Onayla'}
                        </button>
                        <button class="btn btn-small btn-danger" onclick="rejectListing(${listing.id})" ${listing.status === 'rejected' ? 'disabled' : ''}>
                            ${listing.status === 'rejected' ? 'Reddedildi' : 'Reddet'}
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Toplu √∂demeleri g√∂ster
        function displayBulkPayments() {
            const tbody = document.getElementById('bulkTableBody');
            tbody.innerHTML = '';

            bulkData.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="checkbox" class="item-checkbox" value="${payment.id}" onchange="toggleItemSelection(${payment.id})"></td>
                    <td>${payment.id}</td>
                    <td>${payment.user}</td>
                    <td><span class="status status-${payment.status}">${payment.status === 'completed' ? 'Tamamlandƒ±' : 'Bekliyor'}</span></td>
                    <td>${payment.date}</td>
                    <td>
                        <button class="btn btn-small btn-primary">Detay</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // √ñƒüe se√ßimini deƒüi≈ütir
        function toggleItemSelection(id) {
            if (selectedItems.has(id)) {
                selectedItems.delete(id);
            } else {
                selectedItems.add(id);
            }
            updateSelectionInfo();
        }

        // T√ºm√ºn√º se√ß/kaldƒ±r
        function toggleSelectAll() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                const id = parseInt(checkbox.value);
                if (selectAllCheckbox.checked) {
                    selectedItems.add(id);
                } else {
                    selectedItems.delete(id);
                }
            });
            
            updateSelectionInfo();
        }

        // T√ºm√ºn√º se√ß
        function selectAllItems() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                selectedItems.add(parseInt(checkbox.value));
            });
            selectAllCheckbox.checked = true;
            updateSelectionInfo();
        }

        // Se√ßimi kaldƒ±r
        function deselectAllItems() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            selectAllCheckbox.checked = false;
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Se√ßim bilgisini g√ºncelle
        function updateSelectionInfo() {
            const info = document.getElementById('selectionInfo');
            const count = document.getElementById('selectedCount');
            
            count.textContent = selectedItems.size;
            
            if (selectedItems.size > 0) {
                info.style.display = 'block';
            } else {
                info.style.display = 'none';
            }
        }

        // Toplu aktifle≈ütir
        function bulkActivate() {
            if (selectedItems.size === 0) {
                showAlert('L√ºtfen en az bir √∂ƒüe se√ßin!', 'error');
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            let updatedCount = 0;

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const user = demoUsers.find(u => u.id === id);
                    if (user && user.status !== 'active') {
                        user.status = 'active';
                        updatedCount++;
                    }
                } else if (actionType === 'listings') {
                    const listing = demoListings.find(l => l.id === id);
                    if (listing && listing.status !== 'active') {
                        listing.status = 'active';
                        updatedCount++;
                    }
                }
            });

            showAlert(`${updatedCount} √∂ƒüe aktifle≈ütirildi!`, 'success');
            loadBulkData(); // Tabloyu yenile
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Tek aktifle≈ütir
        function singleActivate() {
            if (selectedItems.size !== 1) {
                showAlert('L√ºtfen sadece bir √∂ƒüe se√ßin!', 'error');
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            const selectedId = Array.from(selectedItems)[0];

            if (actionType === 'users') {
                const user = demoUsers.find(u => u.id === selectedId);
                if (user && user.status !== 'active') {
                    user.status = 'active';
                    showAlert(`Kullanƒ±cƒ± ${user.name || user.email} aktifle≈ütirildi!`, 'success');
                } else {
                    showAlert('Bu kullanƒ±cƒ± zaten aktif!', 'info');
                }
            } else if (actionType === 'listings') {
                const listing = demoListings.find(l => l.id === selectedId);
                if (listing && listing.status !== 'active') {
                    listing.status = 'active';
                    showAlert(`ƒ∞lan ${listing.title} onaylandƒ±!`, 'success');
                } else {
                    showAlert('Bu ilan zaten onaylƒ±!', 'info');
                }
            }

            loadBulkData(); // Tabloyu yenile
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Toplu pasifle≈ütir
        function bulkDeactivate() {
            if (selectedItems.size === 0) {
                showAlert('L√ºtfen en az bir √∂ƒüe se√ßin!', 'error');
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            let updatedCount = 0;

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const user = demoUsers.find(u => u.id === id);
                    if (user && user.status === 'active') {
                        user.status = 'inactive';
                        updatedCount++;
                    }
                } else if (actionType === 'listings') {
                    const listing = demoListings.find(l => l.id === id);
                    if (listing && listing.status === 'active') {
                        listing.status = 'pending';
                        updatedCount++;
                    }
                }
            });

            showAlert(`${updatedCount} √∂ƒüe pasifle≈ütirildi!`, 'success');
            loadBulkData(); // Tabloyu yenile
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Toplu sil
        function bulkDelete() {
            if (selectedItems.size === 0) {
                showAlert('L√ºtfen en az bir √∂ƒüe se√ßin!', 'error');
                return;
            }

            if (!confirm(`${selectedItems.size} √∂ƒüeyi silmek istediƒüinizden emin misiniz?`)) {
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            let deletedCount = 0;

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const index = demoUsers.findIndex(u => u.id === id);
                    if (index !== -1) {
                        demoUsers.splice(index, 1);
                        deletedCount++;
                    }
                } else if (actionType === 'listings') {
                    const index = demoListings.findIndex(l => l.id === id);
                    if (index !== -1) {
                        demoListings.splice(index, 1);
                        deletedCount++;
                    }
                } else if (actionType === 'payments') {
                    const index = demoPayments.findIndex(p => p.id === id);
                    if (index !== -1) {
                        demoPayments.splice(index, 1);
                        deletedCount++;
                    }
                }
            });

            showAlert(`${deletedCount} √∂ƒüe silindi!`, 'success');
            loadBulkData(); // Tabloyu yenile
            selectedItems.clear();
            updateSelectionInfo();
        }

        // Toplu dƒ±≈üa aktar
        function bulkExport() {
            if (selectedItems.size === 0) {
                showAlert('L√ºtfen en az bir √∂ƒüe se√ßin!', 'error');
                return;
            }

            const actionType = document.getElementById('bulkActionType').value;
            const selectedData = [];

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const user = demoUsers.find(u => u.id === id);
                    if (user) selectedData.push(user);
                } else if (actionType === 'listings') {
                    const listing = demoListings.find(l => l.id === id);
                    if (listing) selectedData.push(listing);
                } else if (actionType === 'payments') {
                    const payment = demoPayments.find(p => p.id === id);
                    if (payment) selectedData.push(payment);
                }
            });

            const dataStr = JSON.stringify(selectedData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `garajburada-${actionType}-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            window.URL.revokeObjectURL(url);

            showAlert(`${selectedData.length} √∂ƒüe dƒ±≈üa aktarƒ±ldƒ±!`, 'success');
        }

        // Toplu mesaj g√∂nder
        function bulkSendMessage() {
            if (selectedItems.size === 0) {
                showAlert('L√ºtfen en az bir √∂ƒüe se√ßin!', 'error');
                return;
            }

            const message = prompt('G√∂ndermek istediƒüiniz mesajƒ± yazƒ±n:');
            if (!message) return;

            const actionType = document.getElementById('bulkActionType').value;
            let sentCount = 0;

            selectedItems.forEach(id => {
                if (actionType === 'users') {
                    const user = demoUsers.find(u => u.id === id);
                    if (user) sentCount++;
                }
            });

            showAlert(`${sentCount} kullanƒ±cƒ±ya mesaj g√∂nderildi!`, 'success');
        }

        // S√ºresi biten ilanlarƒ± y√ºkle
        async function loadExpiredListings() {
            document.getElementById('expiredLoading').style.display = 'block';
            document.getElementById('expiredTable').style.display = 'none';
            
            try {
                const token = localStorage.getItem('adminToken');
                const response = await fetch('http://localhost:8000/api/admin/expired-listings', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayExpiredListings(data.listings);
                } else {
                    // API √ßalƒ±≈ümƒ±yorsa demo verileri kullan
                    const expiredListings = [
                        {
                            id: 1,
                            title: "2018 BMW 320i",
                            user_email: "ahmet@email.com",
                            price: "‚Ç∫850,000",
                            expires_at: "2025-01-20",
                            status: "expired",
                            days_left: -5
                        },
                        {
                            id: 2,
                            title: "2019 Mercedes C200",
                            user_email: "mehmet@email.com",
                            price: "‚Ç∫1,200,000",
                            expires_at: "2025-01-22",
                            status: "expired",
                            days_left: -3
                        },
                        {
                            id: 3,
                            title: "2020 Audi A4",
                            user_email: "ayse@email.com",
                            price: "‚Ç∫950,000",
                            expires_at: "2025-01-25",
                            status: "expired",
                            days_left: 0
                        },
                        {
                            id: 4,
                            title: "2017 Volkswagen Golf",
                            user_email: "fatma@email.com",
                            price: "‚Ç∫450,000",
                            expires_at: "2025-01-28",
                            status: "expired",
                            days_left: 3
                        }
                    ];
                    displayExpiredListings(expiredListings);
                }
            } catch (error) {
                console.log("API hatasƒ±, demo veriler kullanƒ±lƒ±yor:", error);
                // Demo veriler
                const expiredListings = [
                    {
                        id: 1,
                        title: "2018 BMW 320i",
                        user_email: "ahmet@email.com",
                        price: "‚Ç∫850,000",
                        expires_at: "2025-01-20",
                        status: "expired",
                        days_left: -5
                    },
                    {
                        id: 2,
                        title: "2019 Mercedes C200",
                        user_email: "mehmet@email.com",
                        price: "‚Ç∫1,200,000",
                        expires_at: "2025-01-22",
                        status: "expired",
                        days_left: -3
                    },
                    {
                        id: 3,
                        title: "2020 Audi A4",
                        user_email: "ayse@email.com",
                        price: "‚Ç∫950,000",
                        expires_at: "2025-01-25",
                        status: "expired",
                        days_left: 0
                    },
                    {
                        id: 4,
                        title: "2017 Volkswagen Golf",
                        user_email: "fatma@email.com",
                        price: "‚Ç∫450,000",
                        expires_at: "2025-01-28",
                        status: "expired",
                        days_left: 3
                    }
                ];
                displayExpiredListings(expiredListings);
            }
        }

        // S√ºresi biten ilanlarƒ± g√∂ster
        function displayExpiredListings(listings) {
            const tbody = document.getElementById('expiredTableBody');
            tbody.innerHTML = '';
            
            listings.forEach(listing => {
                const daysLeftText = listing.days_left < 0 ? 
                    `${Math.abs(listing.days_left)} g√ºn √∂nce bitti` : 
                    listing.days_left === 0 ? 'Bug√ºn bitiyor' : 
                    `${listing.days_left} g√ºn kaldƒ±`;
                
                const daysLeftClass = listing.days_left < 0 ? 'status-expired' : 
                                    listing.days_left === 0 ? 'status-pending' : 
                                    'status-active';
                
                const row = `
                    <tr>
                        <td>${listing.id}</td>
                        <td>${listing.title}</td>
                        <td>${listing.user_email}</td>
                        <td>${listing.price}</td>
                        <td>${listing.expires_at}</td>
                        <td><span class="status ${daysLeftClass}">${daysLeftText}</span></td>
                        <td><span class="status status-expired">S√ºresi Bitti</span></td>
                        <td>
                            <button class="btn btn-small btn-info" onclick="viewExpiredListing(${listing.id})" style="margin-right: 5px;">
                                G√∂r√ºnt√ºle
                            </button>
                            <button class="btn btn-small btn-success" onclick="extendListing(${listing.id})" style="margin-right: 5px;">
                                Uzat
                            </button>
                            <button class="btn btn-small btn-danger" onclick="deleteExpiredListing(${listing.id})">
                                Sil
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            document.getElementById('expiredLoading').style.display = 'none';
            document.getElementById('expiredTable').style.display = 'table';
        }

        // S√ºresi biten ilanlarƒ± filtrele
        function filterExpiredListings() {
            const filter = document.getElementById('expiredFilter').value;
            loadExpiredListings(); // ≈ûimdilik t√ºm√ºn√º g√∂ster, ger√ßek uygulamada filtreleme yapƒ±lacak
            showAlert(`${filter} filtresi uygulandƒ±!`, 'success');
        }

        // ƒ∞lan s√ºresini uzat
        async function extendListing(listingId) {
            const days = prompt('Ka√ß g√ºn uzatmak istiyorsunuz?', '30');
            if (days && !isNaN(days)) {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`http://localhost:8000/api/admin/listings/${listingId}/extend?days=${days}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        showAlert(result.message, 'success');
                        loadExpiredListings(); // Tabloyu yenile
                    } else {
                        showAlert('ƒ∞lan s√ºresi uzatƒ±lamadƒ±!', 'error');
                    }
                } catch (error) {
                    console.log("API hatasƒ±:", error);
                    showAlert(`ƒ∞lan ${listingId} s√ºresi ${days} g√ºn uzatƒ±ldƒ±! (Demo)`, 'success');
                    loadExpiredListings(); // Tabloyu yenile
                }
            }
        }

        // S√ºresi biten ilanƒ± sil
        function deleteExpiredListing(listingId) {
            if (confirm(`ƒ∞lan ${listingId} silinecek. Bu i≈ülem geri alƒ±namaz. Devam etmek istiyor musunuz?`)) {
                showAlert(`ƒ∞lan ${listingId} silindi!`, 'success');
                loadExpiredListings(); // Tabloyu yenile
            }
        }

        // T√ºm s√ºresi biten ilanlarƒ± uzat
        async function extendAllExpired() {
            const days = prompt('T√ºm s√ºresi biten ilanlarƒ± ka√ß g√ºn uzatmak istiyorsunuz?', '30');
            if (days && !isNaN(days)) {
                try {
                    const token = localStorage.getItem('adminToken');
                    const response = await fetch(`http://localhost:8000/api/admin/listings/extend-all-expired?days=${days}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        showAlert(result.message, 'success');
                        loadExpiredListings(); // Tabloyu yenile
                    } else {
                        showAlert('ƒ∞lanlar uzatƒ±lamadƒ±!', 'error');
                    }
                } catch (error) {
                    console.log("API hatasƒ±:", error);
                    showAlert(`T√ºm s√ºresi biten ilanlar ${days} g√ºn uzatƒ±ldƒ±! (Demo)`, 'success');
                    loadExpiredListings(); // Tabloyu yenile
                }
            }
        }

        // T√ºm s√ºresi biten ilanlarƒ± sil
        function deleteAllExpired() {
            if (confirm('T√ºm s√ºresi biten ilanlar silinecek. Bu i≈ülem geri alƒ±namaz. Devam etmek istiyor musunuz?')) {
                showAlert('T√ºm s√ºresi biten ilanlar silindi!', 'success');
                loadExpiredListings(); // Tabloyu yenile
            }
        }

        // S√ºresi biten ilanƒ± g√∂r√ºnt√ºle
        function viewExpiredListing(listingId) {
            const listing = demoListings.find(l => l.id === listingId);
            if (listing) {
                const details = `
                    <strong>ƒ∞lan Detaylarƒ±:</strong><br>
                    <strong>ID:</strong> ${listing.id}<br>
                    <strong>Ba≈ülƒ±k:</strong> ${listing.title}<br>
                    <strong>Kullanƒ±cƒ±:</strong> ${listing.user}<br>
                    <strong>Fiyat:</strong> ${listing.price}<br>
                    <strong>Durum:</strong> S√ºresi Bitti<br>
                    <strong>Olu≈üturulma:</strong> ${listing.created_at || '2025-01-15'}
                `;

                if (confirm(details + '\n\nBu ilanƒ± detaylƒ± g√∂r√ºnt√ºlemek istiyor musunuz?')) {
                    window.open(`/listing/${listing.id}`, '_blank');
                }
            }
        }

        // Sayfa y√ºklendiƒüinde kullanƒ±cƒ±larƒ± y√ºkle
        window.onload = function() {
            loadUsers();
            updateStats();
            updateCharts(); // Grafikleri y√ºkle
        };
    </script>
</body>
</html> 